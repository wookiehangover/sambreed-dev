---

export interface Props {
  title: string;
  slug: string
  description?: string;
}

const { title, slug, description = "" } = Astro.props

const mailto = {
	subject: encodeURIComponent(`Re: ${title}`),
	body: encodeURIComponent(`

Link to: <a href="https://sambreed.dev/writing/${slug}">${title}</a>

`),
}

---
<section>
  <header></header>
  <div>
    <a href={`mailto:samuel.breed@gmail.com?subject=${mailto.subject}&body=${mailto.body}`}>â†’ Reply</a>
    <share-button data-title={title} data-link={`https://sambreed.dev/writing/${slug}`} data-desc={description}>
      <button class="share-button">Share</button>
    </share-button>
  </div>
</section>

<style>
  div {
    display: flex;
    gap: 1rem;
    font-family: var(--font-family-heading);
  }

  a {
    text-decoration: none;
    color: var(--text-dim);
  }

  button {
    background-color: transparent;
    border-width: 0;
    font-family: inherit;
    font-size: inherit;
    font-style: inherit;
    font-weight: inherit;
    line-height: inherit;
    padding: 0;
    color: var(--text-dim);
  }

  a:hover, button:hover {
    cursor: pointer;
    text-decoration: underline;
    text-underline-offset: 2px;
  }
</style>

<script>
  class ShareButton extends HTMLElement {
    constructor() {
      super()

      const title = this.dataset.title
      const link = this.dataset.link
      const description = this.dataset.desc

      if (!link) return

      const $button = this.querySelector('button')

      if (!$button) return

      $button.addEventListener('click', () => {
        if ('share' in navigator) {
          try {
            window.navigator.share({
              title,
              url: link,
              text: description,
            })
          } catch(error) {
            console.error(error)
          }
        } else if ('clipboard' in navigator) {
          try {
            window.navigator.clipboard.writeText(link)
            const text = $button.innerText
            $button.innerText = 'Copied link ðŸ“‹'
            setTimeout(() => {
              $button.innerText = text
            }, 1000)
          } catch (error) {
            console.error(error)
          }
        }
      })
    }
  }

  customElements.define('share-button', ShareButton)
</script>